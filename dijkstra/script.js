var container=document.getElementById("container"),scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.1,1e3);(camera=new THREE.OrthographicCamera(-1,1,1,-1,1,1e3)).position.set(50,10,1),camera.zoom=30;var frustumSize=1e3,renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0});renderer.setSize(window.innerWidth,window.innerHeight),renderer.setPixelRatio(window.devicePixelRatio),container.appendChild(renderer.domElement);var latofont,controls=new THREE.OrbitControls(camera,renderer.domElement),clock=new THREE.Clock,colors=[15559258,16052667,10207676,6071465,15133664,15775359,16670549,14078385,13103055,15660507,5263695,15884124,16769126,2390944,7389619],ROOT_COLOR=colors[0],DEFAULT_VERTEX_COLOR=colors[2],DEFAULT_EDGE_COLOR=colors[3],NEIGHTBOR_COLOR=colors[4],VISITED_COLOR=15772835,resolution=new THREE.Vector2(window.innerWidth,window.innerHeight),graph=new THREE.Object3D;function makeLine(e,t){var n=new MeshLine;n.setGeometry(e);var r=new MeshLineMaterial({useMap:!1,color:new THREE.Color(colors[t]),opacity:1,resolution:resolution,sizeAttenuation:!0,lineWidth:.01,near:camera.near,far:camera.far}),o=new THREE.Mesh(n.geometry,r);return graph.add(o),o}function config(e){(new THREE.FontLoader).load("Lato Light_Regular.json",function(t){latofont=t,e()})}function makeText(e){var t=new THREE.TextGeometry(e,{font:latofont,size:1,height:.1,curveSegments:12}),n=new MeshLineMaterial({useMap:!1,color:new THREE.Color(DEFAULT_VERTEX_COLOR),opacity:1,resolution:resolution,sizeAttenuation:!0,lineWidth:.01,near:camera.near,far:camera.far}),r=new THREE.Mesh(t,n);return graph.add(r),r}function randomConnectDots(e){for(var t=0;t<e.length;t++)for(var n=t+1;n<e.length;n++){if(Math.random()>1-2.5/e.length){var r=new THREE.Geometry,o=e[t].position.x,i=e[t].position.y,a=e[t].position.z;r.vertices.push(new THREE.Vector3(o,i,a)),o=e[n].position.x,i=e[n].position.y,a=e[n].position.z,r.vertices.push(new THREE.Vector3(o,i,a));var s=makeLine(r,3),c=Math.floor(10*Math.random()),d=makeText(String(c)),l=r.vertices[0],u=r.vertices[1],m=l.clone().addScaledVector(u,-1).multiplyScalar(.5).add(u);d.position.copy(m),"edges"in e[n]||(e[n].edges=[]),"edges"in e[t]||(e[t].edges=[]);var h={mesh:s,vertices:[e[t],e[n]],text:d,weight:c};e[n].edges.push(h),e[t].edges.push(h)}}return[]}function createDots(e,t){var n=Math.PI,r=[],o=0;r.push(addSphericPoint(t,0,0));for(var i=2;i<=e-1;i++){var a=2*(i-1)/(e-1)-1,s=Math.acos(a),c=(o+3.6/Math.sqrt(e*(1-a*a)))%(2*n);o=c,r.push(addSphericPoint(t,s,c))}return r.push(addSphericPoint(t,n,0)),r}function addSphericPoint(e,t,n){var r=new THREE.SphereGeometry(1,32,32),o=new MeshLineMaterial({useMap:!1,color:new THREE.Color(colors[0]),opacity:1,resolution:resolution,sizeAttenuation:!0,lineWidth:.01,near:camera.near,far:camera.far}),i=new THREE.Mesh(r,o);return i.position.x=e*Math.sin(t)*Math.cos(n),i.position.y=e*Math.sin(t)*Math.sin(n),i.position.z=e*Math.cos(t),i.material.uniforms.color.value.setHex(colors[1]),graph.add(i),i}function colorDots(e){e[0].material.uniforms.color.value.setHex(ROOT_COLOR);for(var t=1;t<e.length;t++)e[t].material.uniforms.color.value.setHex(DEFAULT_VERTEX_COLOR)}function setMenu(e){function t(e){for(var t=document.getElementsByClassName(e),n=0;n<t.length;n++){t[n].style.display="none"}}function n(e){for(var t=document.getElementsByClassName(e),n=0;n<t.length;n++){t[n].style.display="block"}}switch(e){case"dijkstra":t("begin"),n("dijkstra"),document.getElementById("nodes-number-dijkstra").value=document.getElementById("nodes-number").value,document.getElementById("nodes-visited").value=1,document.getElementById("nodes-next").value="-";break;case"begin":t("dijkstra"),n("begin")}}function init(){setMenu("dijkstra");var e=document.getElementById("nodes-number").value;console.log(e);config(function(){var t=createDots(e,10);randomConnectDots(t),colorDots(t),dijkstra(t)})}graph.rotation.y=Math.PI/2,scene.add(graph),setMenu("begin"),render();var ijk=-1;function continueDijkstra(){function e(e,t){e.material.uniforms.color.value.setHex(t)}if(ijk+=1,console.log(i%2),ijk%2==0)new_vertex.edges.forEach(function(t){var n,r,o=t.vertices[0]==new_vertex?t.vertices[1]:t.vertices[0];o.visited||(e(o,NEIGHTBOR_COLOR),e(t.mesh,NEIGHTBOR_COLOR)),!o.visited&&(null==o.distance||o.distance>new_vertex.distance+t.weight)&&(neightbors[o.vid]=o,neightbors_edge[o.vid]=t,o.distance=new_vertex.distance+t.weight,n=o,r=String(o.distance),"text"in n&&(graph.remove(n.text),n.text.geometry.dispose(),n.text.material.dispose()),(r=makeText(r)).position.copy(n.position),r.position.y=r.position.y+1,n.text=r,graph.add(r),e(o.text,NEIGHTBOR_COLOR))}),document.getElementById("nodes-next").value=Object.keys(neightbors).length;else{var t=null;for(var n in neightbors){var r=neightbors[n];(!t||t.distance>r.distance)&&(t=r)}var o=neightbors_edge[t.vid];e(t,VISITED_COLOR),e(t.text,VISITED_COLOR),e(o.mesh,VISITED_COLOR),e(o.text,VISITED_COLOR),delete neightbors[t.vid],t.visited=!0,new_vertex=t,document.getElementById("nodes-visited").value=Number(document.getElementById("nodes-visited").value)+1}}var new_vertex,neightbors,neightbors_edge,vertices={};function dijkstra(e){e.forEach(function(e,t){vertices[t]=e,e.visited=!1,e.vid=t}),new_vertex=e[0],e[0].visited=!0,new_vertex.distance=0,neightbors={},i=0,neightbors_edge={}}function onWindowResize(){var e=container.clientWidth,t=container.clientHeight,n=e/t;camera.left=-frustumSize*n/2,camera.right=frustumSize*n/2,camera.top=frustumSize/2,camera.bottom=-frustumSize/2,camera.updateProjectionMatrix(),renderer.setSize(e,t),resolution.set(e,t)}function render(){requestAnimationFrame(render),controls.update(),graph.rotation.y+=.01*clock.getDelta(),renderer.render(scene,camera)}onWindowResize(),window.addEventListener("resize",onWindowResize);